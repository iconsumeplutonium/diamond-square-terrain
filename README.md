
# Diamond-Square Terrain Generator
#### Video Demo: https://youtu.be/KVVX2OB5U4o
#### Description: A program that procedurally generates terrain using the Diamond-Square algorithm


#### Prerequisites
This program requires Python 3.6 or up. It utilizes the random and time libraries, both of which should already come preinstalled with Python. It also utilizes the PIL and tkinter libraries, both of which must be installed separately.

test.py is the only file in the program, which is responsible for handling everything in the program, from generating the terrain itself, to coloring it, to displaying the UI.

#### The Diamond-Square algorithm
https://en.wikipedia.org/wiki/Diamond-square_algorithm

The diamond-square algorithm is a special algorithm that generates terrain on a heightmap of size 2ⁿ + 1.
![An overview of the algorithm. ](https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/Diamond_Square.svg/1920px-Diamond_Square.svg.png)

First, it takes the array and initializes each corner point to a random value. Next comes the diamond step, in which the value of the center of the square is calculated by taking the average of the 4 corners, plus a random offset. Then comes the square step, in which the midpoints of the sides of the square are calculated via the average of the values of the other points, plus another offset. For example, in the third image from the left, the value of the top middle point is equal to the average of the top right point, the top left point, and the middle point, plus a random offset. The diamond and square steps are then repeated until every point in the array has a value.

This algorithm is simple at its core, hence why it is popular. However, at large array sizes, it becomes pretty inefficient and slow.

#### test.py

![The program](https://cdn.discordapp.com/attachments/690652979036028929/838970063301640213/unknown.png)
Upon launching the program, you will be greeted by something like this. The image at the top is the terrain generated by the algorithm itself. Blue represents water, peach is sand, green is grass, gray is rocks/mountains, and white is snow/mountain peaks. Each image is generated uniquely, so you will get something different when running it. Sometimes you might get terrain that is all water or a few sparse islands, and other times you might get massive land masses with massive mountain ranges, filled with large snow-capped peaks.

The text below it will tell you how long it took to generate the map and image. In my case, it took 1.989 seconds to generate that image on my machine.

The "generate new map" button at the very bottom will generate a new map every time it is clicked.

(Gif sped up 3x to show terrain generation)
![New terrain generated at the push of a button. Sped up 3x for the purpose of showing the terrain.](https://cdn.discordapp.com/attachments/690652979036028929/839327224724848700/button2.gif)

There is also a slider in the application window called "Map Size" with a default value of 10. This means that the terrain being generated is 2¹⁰ + 1 on all sides, so 1,025 by 1,025. The slider allows the user to adjust the value between 1 (3 by 3) all the way till 20 (1,048,577 by  1,048,577).

Because the Diamond-Square algorithm generates terrain on a square map, the amount of time it takes to generate maps with successive map heights gets exponentially larger. For example, my laptop takes 0.5 seconds to generate terrain with a size of 9 (513 by 513), about 2 seconds for 10 (1,025 by 1,025), about 8 seconds for 11 (2,049 by 2,049), and about 2 minutes for 12 (4,097 by 4,097). This is one of the trade-offs of using the Diamond-Square algorithm in actual programs: it is easy to implement, but highly inefficient, to the point where the program may stop responding entirely if run on a lower-end laptop or PC. I myself cannot run any values higher than about 13 (8,193 by 8,193) or 14 (16,385 by 16,385). However, I have capped the high end of the slider to be 20, for those who happen to have extra beefy PCs that can handle such calculations.

#### The Code
The function `diamond_square()` is the main function responsible for the terrain generation itself. It depends on two sub functions, `diamond_step()` and `square_step()`, which perform the step of the algorithm for which they are named, each of which depend on the `roughness_offset()` function to generate a random roughness offset. Normally in implementations of Diamond-Square, the roughness is some small value, such as 2, which gets smaller as the algorithm progresses. However, for my purposes, I found that using a simple number as that generated terrain that was a bit too boring. I instead changed the function to generate a random value between -7 and 7, multiplied by the roughness, which has a default value of 10. The roughness gets halved after every iteration, so on the first pass, the roughness is between -70 and 70, on the second it is between -35 and 35, the third is between -17.5 and 17.5, and so on.

The map is returned as a 2D array of values. To display this, the map is turned into an image by the PIL library. Originally when I wrote the rendering code, I originally used [John Zelle's graphics.py script](https://mcsp.wartburg.edu/zelle/python/) to draw each pixel to the screen individually. However, this was incredibly inefficient and slow, so as my project progressed, I switched over to using the PIL library to turn the array into an image, which sped things up immensely. The function `img_from_diamond_square()` calls the `diamond_square()` function, turns the resulting array into an image and returns the image. It utilizes the `color_assignment()` function to assign color based on a height input. Blue (water) is values less than 50, peach (sand) is between 50 and 55, green (grass) is between 55 and 90, gray (mountains/rocks) are between 90 and 110, and white (snow/mountain peaks) are 110 or above.

`main()` handles the UI and window. It first uses `img_from_diamond_square()` to get terrain. Then it uses tkinter to create a window, display the terrain image, and add additional text, sliders, and buttons. The time library is called before and after `img_from_diamond_square()` to time how long it took to generate the image and terrain. The time is then updated on the screen.

When the `Generate new map` button is pushed, tkinter calls the `generate_button_callback()` function, which calls and times `img_from_diamond_square()` to get new terrain and resizes it. It then replaces the time and image on screen with the new time using tkinter.

The value of the Map Size slider (clamped between 1 and 20) directly controls the map size of the new terrain when the "Generate new map" button is pressed. The current value of the slider is passed through `generate_button_callback()`, which the passes that value to `img_from_diamond_square()`, which uses it as the map size to generate new terrain.

